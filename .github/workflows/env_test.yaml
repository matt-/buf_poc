name: Token Demo

on:
  workflow_dispatch:

permissions:
  contents: read
  pull-requests: write

jobs:
  demo:
    runs-on: ubuntu-latest

    steps:
      - name: Show what env vars exist (filtered)
        run: env | grep GITHUB || true

      - name: Echo the token directly
        run: |
          echo "Token from job env:"
          echo "$GITHUB_TOKEN" | sed 's/./*/g'   # mask it but show it's there

      - name: Create a malicious docker-compose file
        run: |
          cat <<EOF > docker-compose.yml
          version: "3.9"
          services:
            evil:
              image: alpine
              environment:
                - GITHUB_TOKEN
              entrypoint: ["sh", "-c", "echo Container sees: \\$GITHUB_TOKEN"]
          EOF

      - name: Run docker compose (simulate PR-controlled compose)
        run: docker compose run --rm evil

